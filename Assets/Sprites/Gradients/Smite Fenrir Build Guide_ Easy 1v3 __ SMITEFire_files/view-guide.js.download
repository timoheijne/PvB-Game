$(document).ready(adjustSlice);$(window).load(adjustSlice);function adjustSlice(){var sliceHeight=$('.sf-guide__banner__slice').outerHeight();$('.slice').css('border-top-width',sliceHeight);}
$(document).ready(function(){console.log(window.location.hash);if(window.location.hash=="#discussion"||window.location.hash.includes("#comment"))
{$('.sf-guide__builds').hide();$('.sf-guide__discussion').show();$('.sf-guide__nav span').removeClass('active');$('.sf-guide__nav [trigger="discussion"]').addClass('active');}
$('.sf-guide__nav span').on('click',function(){if(!$(this).hasClass('active')){$(this).addClass('active').siblings().removeClass('active');var trigger=$(this).attr('trigger');switch(trigger){case "build":$('.sf-guide__builds').show();$('.sf-guide__discussion').hide();window.location.hash='';break;case "discussion":$('.sf-guide__builds').hide();$('.sf-guide__discussion').show();window.location.hash='discussion';break;case "more-guides":$('.sf-guide__builds').hide();$('.sf-guide__discussion').hide();break;}}});$('.sf-guide__builds__switcher__current').on('click',function(){$('.sf-guide__builds__switcher__current').toggleClass('open');$('.sf-guide__builds__switcher__list').slideToggle();});$('.sf-guide__builds__switcher__list span').on('click',function(){var val=$(this).text();var num=parseInt($(this).attr('build-num'))-1;$(this).addClass('current').siblings().removeClass('current');$('.sf-guide__builds__switcher__current > span').text(val);$('.sf-guide__builds__switcher__list').slideUp(400,function(){$('.sf-guide__builds__switcher__current').removeClass('open');});$('.sf-guide__build').hide().eq(num).show();});$(document).on('click','.threat-bar__options img',function(){var id=$(this).attr('god-id');$('.threat-bar__content__god').hide().filter('[god-id='+id+']').show();$(this).addClass('current').siblings().removeClass('current');});$('.threat-bar__bar__section').on('click',function(){var level=$(this).attr('threat-level');var gods=$(this).parents('.threat-bar').find('.threat-bar__content__god');var godsFiltered=gods.filter('[threat-level='+level+']');gods.hide();$(this).addClass('current').siblings().removeClass('current');var optionsHTML="";godsFiltered.each(function(){var img=$(this).find('img').attr('src');var id=$(this).attr('god-id');optionsHTML+="<img god-id='"+id+"' src='"+img+"'>";});$('.threat-bar__options').html(optionsHTML);$('.threat-bar__options img').eq(0).trigger('click');});var done=false;$('.threat-bar__bar__section').each(function(){var num=parseInt($(this).find('.threat-bar__bar__section__num').text());if(num!=0&&!done){$(this).trigger('click');done=true;}});});var votePopupResult='';function votePopupEnded(result)
{votePopupResult=result;}
function voteRecaptchaCallback(response)
{$('.captcha-popup .close').click();if(store.get('guestCaptchaVoteScore')<0)$('.build-vote-down').click();else $('.build-vote-up').click();}
var voteRecaptchaWidget=null;$(document).on('click','.build-vote-up',function(){var wasSelected=$('.build-vote-up').hasClass('selected');var recaptchaResponse=null;if(voteRecaptchaWidget!==null)recaptchaResponse=grecaptcha.getResponse(voteRecaptchaWidget);$.post('/ajax/vote',{'relation_type':'Guide','relation_id':guideId,'score':'1','deselect':wasSelected,'g-recaptcha-response':recaptchaResponse},function(data){if(data.success)
{store.remove("guestCaptchaVoteScore");store.remove("guestCaptchaVoteId");$('.build-vote-up').removeClass('expired').removeClass('selected').addClass('not-selected');$('.build-vote-down').removeClass('expired').removeClass('selected').addClass('not-selected');if(!wasSelected)$('.build-vote-up').addClass('selected').removeClass('not-selected');return false;}
else if(data.action=='login')
{store.set('guestVoteScore','1');store.set('guestVoteId','{$guide.build_id}');$.eventTriggered('build-upvote-guest');$('.login-popup').show();$('.fade-bg').show();}
else if(data.action=='captcha')
{store.set('guestCaptchaVoteScore','1');store.set('guestCaptchaVoteId','{$guide.build_id}');$.eventTriggered('build-upvote-captcha');$('.captcha-popup').show();if(voteRecaptchaWidget!==null)grecaptcha.reset(voteRecaptchaWidget);else voteRecaptchaWidget=grecaptcha.render('vote-recaptcha-container',{'sitekey':gkey,'theme':'dark','callback':'voteRecaptchaCallback',});$('.fade-bg').show();}
else if(data.html_message)$.colorbox({html:data.html_message,width:400});else alert('Vote failed. Reason: '+data.message);return false;},'json');return false;});$(document).on('click','.build-vote-down',function(){var wasSelected=$('.build-vote-down').hasClass('selected');var recaptchaResponse=null;if(voteRecaptchaWidget!==null)recaptchaResponse=grecaptcha.getResponse(voteRecaptchaWidget);$.post('/ajax/vote',{'relation_type':'Guide','relation_id':guideId,'score':'-1','deselect':wasSelected,'g-recaptcha-response':recaptchaResponse},function(data){if(data.success){store.remove("guestCaptchaVoteScore");store.remove("guestCaptchaVoteId");$('.build-vote-up').removeClass('expired').removeClass('selected').addClass('not-selected');$('.build-vote-down').removeClass('expired').removeClass('selected').addClass('not-selected');if(!wasSelected)$('.build-vote-down').addClass('selected').removeClass('not-selected');return false;}
else if(data.action=='login')
{store.set('guestVoteScore','-1');store.set('guestVoteId','{$guide.build_id}');$.eventTriggered('build-downvote-guest');$('.login-popup').show();$('.fade-bg').show();}
else if(data.action=='captcha')
{store.set('guestCaptchaVoteScore','-1');store.set('guestCaptchaVoteId','{$guide.build_id}');$.eventTriggered('build-downvote-captcha');$('.captcha-popup').show();if(voteRecaptchaWidget!==null)grecaptcha.reset(voteRecaptchaWidget);else voteRecaptchaWidget=grecaptcha.render('vote-recaptcha-container',{'sitekey':gkey,'theme':'dark','callback':'voteRecaptchaCallback',});$('.fade-bg').show();}
else if(data.html_message)$.colorbox({html:data.html_message,width:400});else alert('Vote failed. Reason: '+data.message);return false;},'json');return false;});